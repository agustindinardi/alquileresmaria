{% extends 'base.html' %}

{% block title %}{% if form.instance.id %}Editar Vehículo{% else %}Nuevo Vehículo{% endif %}{% endblock %}

{% load widget_tweaks %}

{% block content %}

<div class="container py-5"> <div class="row justify-content-center"> <div class="col-md-8"> <div class="card shadow"> <div class="card-header bg-primary text-white"> <h3 class="mb-0"> {% if form.instance.id %} Editar Vehículo: {{ form.instance.marca }} {{ form.instance.modelo }} {% else %} Registrar Nuevo Vehículo {% endif %} </h3> </div> <div class="card-body"> <form method="post" enctype="multipart/form-data" novalidate id="vehiculoForm"> {% csrf_token %}
                    {% if form.non_field_errors %}
                        <div class="alert alert-danger">
                            {% for error in form.non_field_errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                    {% endif %}

                    <div class="row">
                        <!-- Primera columna -->
                        <div class="col-md-6">
                            <!-- Marca -->
                            <div class="mb-3">
                                <label for="{{ form.marca.id_for_label }}" class="form-label">{{ form.marca.label }}{% if form.marca.field.required %}*{% endif %}</label>
                                {{ form.marca|add_class:"form-control campo-obligatorio" }}
                                {% if form.marca.errors %}
                                    <div class="text-danger small">{{ form.marca.errors }}</div>
                                {% endif %}
                                {% if form.marca.help_text %}
                                    <div class="form-text">{{ form.marca.help_text }}</div>
                                {% endif %}
                            </div>

                            <!-- Tipo -->
                            <div class="mb-3">
                                <label for="{{ form.tipo.id_for_label }}" class="form-label">{{ form.tipo.label }}{% if form.tipo.field.required %}*{% endif %}</label>
                                {{ form.tipo|add_class:"form-select campo-obligatorio" }}
                                {% if form.tipo.errors %}
                                    <div class="text-danger small">{{ form.tipo.errors }}</div>
                                {% endif %}
                                {% if form.tipo.help_text %}
                                    <div class="form-text">{{ form.tipo.help_text }}</div>
                                {% endif %}
                            </div>

                            <!-- Modelo -->
                            <div class="mb-3">
                                <label for="{{ form.modelo.id_for_label }}" class="form-label">{{ form.modelo.label }}{% if form.modelo.field.required %}*{% endif %}</label>
                                {{ form.modelo|add_class:"form-control campo-obligatorio" }}
                                {% if form.modelo.errors %}
                                    <div class="text-danger small">{{ form.modelo.errors }}</div>
                                {% endif %}
                                {% if form.modelo.help_text %}
                                    <div class="form-text">{{ form.modelo.help_text }}</div>
                                {% endif %}
                            </div>

                            <!-- Año -->
                            <div class="mb-3">
                                <label for="{{ form.ano.id_for_label }}" class="form-label">{{ form.ano.label }}{% if form.ano.field.required %}*{% endif %}</label>
                                {{ form.ano|add_class:"form-control campo-obligatorio" }}
                                {% if form.ano.errors %}
                                    <div class="text-danger small">{{ form.ano.errors }}</div>
                                {% endif %}
                                {% if form.ano.help_text %}
                                    <div class="form-text">{{ form.ano.help_text }}</div>
                                {% endif %}
                            </div>

                            <!-- Patente -->
                            <div class="mb-3">
                                <label for="{{ form.patente.id_for_label }}" class="form-label">{{ form.patente.label }}{% if form.patente.field.required %}*{% endif %}</label>
                                {{ form.patente|add_class:"form-control campo-obligatorio" }}
                                {% if form.patente.errors %}
                                    <div class="text-danger small">{{ form.patente.errors }}</div>
                                {% endif %}
                                {% if form.patente.help_text %}
                                    <div class="form-text">{{ form.patente.help_text }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Segunda columna -->
                        <div class="col-md-6">
                            <!-- Capacidad -->
                            <div class="mb-3">
                                <label for="{{ form.capacidad.id_for_label }}" class="form-label">{{ form.capacidad.label }}{% if form.capacidad.field.required %}*{% endif %}</label>
                                {{ form.capacidad|add_class:"form-control campo-obligatorio" }}
                                {% if form.capacidad.errors %}
                                    <div class="text-danger small">{{ form.capacidad.errors }}</div>
                                {% endif %}
                                {% if form.capacidad.help_text %}
                                    <div class="form-text">{{ form.capacidad.help_text }}</div>
                                {% endif %}
                            </div>

                            <!-- Precio por día -->
                            <div class="mb-3">
                                <label for="{{ form.precio_por_dia.id_for_label }}" class="form-label">{{ form.precio_por_dia.label }}{% if form.precio_por_dia.field.required %}*{% endif %}</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    {{ form.precio_por_dia|add_class:"form-control campo-obligatorio" }}
                                </div>
                                {% if form.precio_por_dia.errors %}
                                    <div class="text-danger small">{{ form.precio_por_dia.errors }}</div>
                                {% endif %}
                                {% if form.precio_por_dia.help_text %}
                                    <div class="form-text">{{ form.precio_por_dia.help_text }}</div>
                                {% endif %}
                            </div>

                            <!-- Kilometraje -->
                            <div class="mb-3">
                                <label for="{{ form.kilometraje.id_for_label }}" class="form-label">{{ form.kilometraje.label }}{% if form.kilometraje.field.required %}*{% endif %}</label>
                                <div class="input-group">
                                    {{ form.kilometraje|add_class:"form-control campo-obligatorio" }}
                                    <span class="input-group-text">km</span>
                                </div>
                                {% if form.kilometraje.errors %}
                                    <div class="text-danger small">{{ form.kilometraje.errors }}</div>
                                {% endif %}
                                {% if form.kilometraje.help_text %}
                                    <div class="form-text">{{ form.kilometraje.help_text }}</div>
                                {% endif %}
                            </div>

                            <!-- Política de reembolso -->
                            <div class="mb-3">
                                <label for="{{ form.politica_reembolso.id_for_label }}" class="form-label">{{ form.politica_reembolso.label }}{% if form.politica_reembolso.field.required %}*{% endif %}</label>
                                {{ form.politica_reembolso|add_class:"form-select campo-obligatorio" }}
                                {% if form.politica_reembolso.errors %}
                                    <div class="text-danger small">{{ form.politica_reembolso.errors }}</div>
                                {% endif %}
                                {% if form.politica_reembolso.help_text %}
                                    <div class="form-text">{{ form.politica_reembolso.help_text }}</div>
                                {% endif %}
                            </div>

                            <!-- Sucursal -->
                            <div class="mb-3">
                                <label for="{{ form.sucursal.id_for_label }}" class="form-label">{{ form.sucursal.label }}{% if form.sucursal.field.required %}*{% endif %}</label>
                                {{ form.sucursal|add_class:"form-select campo-obligatorio" }}
                                {% if form.sucursal.errors %}
                                    <div class="text-danger small">{{ form.sucursal.errors }}</div>
                                {% endif %}
                                {% if form.sucursal.help_text %}
                                    <div class="form-text">{{ form.sucursal.help_text }}</div>
                                {% endif %}
                            </div>

                            <!-- Estado -->
                            <div class="mb-3">
                                <label for="{{ form.estado.id_for_label }}" class="form-label">
                                    {{ form.estado.label }}{% if form.estado.field.required %}*{% endif %}
                                </label>
                                {{ form.estado|add_class:"form-select" }}
                                {% if form.estado.errors %}
                                    <div class="text-danger small">{{ form.estado.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Imagen -->
                    <div class="mb-3">
                        <label for="{{ form.imagen.id_for_label }}" class="form-label">{{ form.imagen.label }}{% if form.imagen.field.required %}*{% endif %}</label>
                        {% if form.instance.imagen %}
                            <div class="mb-2">
                                <img src="{{ form.instance.imagen.url }}" alt="{{ form.instance }}" class="img-thumbnail" style="max-height: 200px;">
                            </div>
                        {% endif %}
                        {{ form.imagen|add_class:"form-control" }}
                        {% if form.imagen.errors %}
                            <div class="text-danger small">{{ form.imagen.errors }}</div>
                        {% endif %}
                        {% if form.imagen.help_text %}
                            <div class="form-text">{{ form.imagen.help_text }}</div>
                        {% endif %}
                    </div>

                    <!-- Descripción -->
                    <div class="mb-3">
                        <label for="{{ form.descripcion.id_for_label }}" class="form-label">{{ form.descripcion.label }}{% if form.descripcion.field.required %}*{% endif %}</label>
                        {{ form.descripcion|add_class:"form-control" }}
                        {% if form.descripcion.errors %}
                            <div class="text-danger small">{{ form.descripcion.errors }}</div>
                        {% endif %}
                        {% if form.descripcion.help_text %}
                            <div class="form-text">{{ form.descripcion.help_text }}</div>
                        {% endif %}
                    </div>

                    <div class="d-flex justify-content-between mt-4">
                        <a href="{% url 'vehiculos:lista' %}" class="btn btn-secondary">Cancelar</a>
                        <button type="submit" class="btn btn-primary" id="submitBtn" disabled>
                            {% if form.instance.id %}Actualizar{% else %}Registrar{% endif %} Vehículo
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('vehiculoForm');
    const submitBtn = document.getElementById('submitBtn');
    const camposObligatorios = document.querySelectorAll('.campo-obligatorio');
    
    function validarFormulario() {
        let todosCompletos = true;
        
        camposObligatorios.forEach(function(campo) {
            if (campo.type === 'select-one') {
                // Para campos select, verificar que no esté vacío o sea el valor por defecto
                if (!campo.value || campo.value === '' || campo.value === '---------') {
                    todosCompletos = false;
                }
            } else {
                // Para campos de texto, verificar que no esté vacío
                if (!campo.value.trim()) {
                    todosCompletos = false;
                }
            }
        });
        
        // Habilitar o deshabilitar el botón según la validación
        submitBtn.disabled = !todosCompletos;
        
        // Cambiar el estilo visual del botón
        if (todosCompletos) {
            submitBtn.classList.remove('btn-secondary');
            submitBtn.classList.add('btn-primary');
        } else {
            submitBtn.classList.remove('btn-primary');
            submitBtn.classList.add('btn-secondary');
        }
    }
    
    // Validar inicialmente
    validarFormulario();
    
    // Agregar event listeners a todos los campos obligatorios
    camposObligatorios.forEach(function(campo) {
        campo.addEventListener('input', validarFormulario);
        campo.addEventListener('change', validarFormulario);
        campo.addEventListener('blur', validarFormulario);
    });
});
</script>

{% endblock %}